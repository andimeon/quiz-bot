# Чат-боты для проведения викторины

Данные боты задают пользователю различные вопросы и предлагают написать правильный ответ. Когда пользователь затрудняется ответить, бот подсказывает правильный ответ.

Для хранения базы данных с вопросами и ответами используется облачный сервис [Redis](https://redislabs.com). Также в базе хранятся сведения о пользователях и последнем вопросе, в виде:

```json
{
  "user_vk_94719491": {"last_asked_question": "question_8291"},
  "user_tg_394629364": {"last_asked_question": "question_9249"}
  ...
}
```

## Пример работы скрипта

Telegram

![screenshot](screenshots/tg_gif.gif)

Vk (Вконтакте)

![screenshot](screenshots/vk_gif.gif)

Посмотреть работу ботов можно следующим образом:

В телеграме добавить бота `@Quiz_AI_Bot`.

В Вконтакте необходимо вступить в сообщество [Викторина](https://vk.com/public197662307), и во вкладке сообщения нажать кнопку `start`.

## Переменные и среда окружения

Доступны 6 переменных окружения:

`TG_TOKEN` - токен от бота в телеграмме.

`VK_TOKEN` - токен от бота в VK.

`QUIZ_FILES_PATH` - путь к `txt` файлам с вопросами и ответами.

`REDIS_URL` - адрес базы данных.

`REDIS_PORT` - порт базы данных.

`REDIS_PASSWORD` - пароль к базе данных.

## Локальный запуск на компьютере

Переменные окружения активируются различными способами.

Либо с помощью библиотеки [python-dotenv](https://pypi.org/project/python-dotenv/). Тогда переменные необходимо поместить в файл `.env`.

Либо использованием приложения [direnv](https://github.com/direnv/direnv). Установку и активацию библиотеки необходимо провести согласно инструкции для своей оболочки.В файл `.envrc` который должен находится в папке проекта нужно поместить переменные окружения.
После этого, при входе в папку и запуске скриптов ботов переменные будут подгружаться автоматически (необходимо только
исправить определение переменных в скрипте, согласно инструкциям в библиотеке).

Либо из командной строки:

```bash
export VARIABLE=VALUE
```

***

### Перед дальнейшими шагами рекомендуется активировать виртуальное окружение venv

Скрипт адаптирован под Python ver 3.8.0.

Используйте `pip` для установки зависимостей:

```bash
pip install -r requirements.txt
```

Запуск проекта осуществляется из командной строки:

```bash
python tg_bot.py
python vk_bot.py
```

## Деплой на сервис [heroku](https://dashboard.heroku.com/apps)

Боты подготовлены к деплою на Heroku. Создайте приложение на сервере, клонируйте репозиторий. Обязательно в `Settings` пропишите переменные окружения.

## Дополнительные скрипты в репозитории

`quiz_dict.py` считывает информацию из текстовых файлов с вопросами и ответами. Для правильного считывания информация в файлах должна быть подготовлена по образцу:

```text
Вопрос 1:
Кайл Чайка называет оводом корабль пришельцев из фильма "Прибытие". В
статье "Построение овода" утверждается, что он состоит из двух половин
окружностей разных диаметров. Напишите в исходном виде любое из слов, в
котором мы пропустили одну букву.

Ответ:
Овоидом.

Зачет:
Овоида; овоид.

Комментарий:
Этот турнир мы по старой традиции решили начать ab ovo - с яйца. Овоид -
геометрическая фигура, подобная яйцу.
```

Скрипт считывает информацию и отправляется в базу данный в следующем виде:

```json
{
  "question_1": {"question":"Текст вопроса викторины", 
                 "answer":"Ответ на вопрос", 
                 "offset":"Зачет на вопрос", 
                 "fail":"Незачет по ответу", 
                 "comment":"Комментарий к ответу"},

  "question_2": {"question":"Текст вопроса викторины", 
                 "answer":"Ответ на вопрос", 
                 "offset":"Зачет на вопрос", 
                 "fail":"Незачет по ответу", 
                 "comment":"Комментарий к ответу"},
  ...
  "question_8291": {"question":"Текст вопроса викторины", 
                 "answer":"Ответ на вопрос", 
                 "offset":"Зачет на вопрос", 
                 "fail":"Незачет по ответу", 
                 "comment":"Комментарий к ответу"},
  ...
}
```

`reddis_connection.py` устанавливает связь с базой данных `Redis`.

## Цель проекта

Код написан в образовательных целях на онлайн-курсе для веб-разработчиков [dvmn.org](https://dvmn.org/modules/).
